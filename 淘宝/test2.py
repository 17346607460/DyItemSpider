#coding:utf-8
import requests
from Crypto.Cipher import AES
from binascii import b2a_hex, a2b_hex
import json

# # 解密后，去掉补足的空格用strip() 去掉
# def decrypt(text):
#     key = 'sycmsycmsycmsycm'.encode('utf-8')
#     iv = b'mcysmcysmcysmcys'
#     mode = AES.MODE_CBC
#     cryptos = AES.new(key, mode, iv)
#     plain_text = cryptos.decrypt(a2b_hex(text))
#     res = bytes.decode(plain_text).rstrip('\0')
#     # print(res)
#     if res[0] == '[':
#         num = res.find(']',-16)
#         res = res[:num + 1]
#         try:
#             data = json.loads(res.replace('\t','').replace(' ', '').replace('：',':'),strict=False)
#         except Exception as e:
#             with open('报错的内容.txt','a') as f:
#                 f.write('错误:{}'.format(str(e)) + res + '\n\n')
#             data = ""
#         return data
#     elif res[0] == '{':
#         if res[-1] != '}':
#             num = res.find('}', -16)
#             res = res[:num + 1]
#         try:
#             data = json.loads(res.replace('\t', '').replace(' ', '').replace('：', ':'), strict=False)
#         except Exception as e:
#             with open('报错的内容.txt', 'a') as f:
#                 f.write('错误:{}'.format(str(e)) + res + '\n\n')
#             data = ""
#         return data

# 解密后，去掉补足的空格用strip() 去掉




# data = b'EB82223182F156F71B647C1CF0B298926772A5C3061AC38DC204F308A3D35158003A9F2F7F95296F495859BC304165C051B9AB1854434CD2837856CF4567CC588CA52DBAFB5C12103B52B2EDFFE4E8E695C5D89AD3A30747DD95A2514A78D9C69845F7FF839889E40A4F5488D3CA44E76E6FD41AD9B6648161F4D9C4857D92351DFECF57723AA147E4F135E91E5B920280AFC6C7A0D6675F1DBF7F3486B04BE3A46FD6A1A7D84E69991881025211030A0EAE6115ACD0762DCFE1EA1D5B8CED9FC21B56A25361CD8D5CE1248353BFEE0DECAC840AC80B946DB8BF2939EBB6A195BCD1E7D4466FED23B16F05F17DAD722DFCA94B3DD2AFA6E617EBB3D37F5ECA0EF4509D14A5109E3DF663183F37F033646957F5A12884F7648529DAF38E9289659135CF1EA8F7D9CB45767C0867C87CE33DD42CDD8A164F6D73014F87A2E29F23B0376C840C3CFD4A6416FB72D1538CE51B48099F265A597D55C1E9F007887451E561ACC2951A264FD899085EECD6D09AB2085485BD613A5EA17E1086EC74A25D1933FE7D45FA49B4C2162ABF4DAEA68B34D50C2E9B047C8F34D1144936714F2C0E6E7C791C71C57643007C5043579787A8148F40E23D1E63FECB70F0958D9336C929644DD34A69C45EC549CA2A136DA0AD65D45AE7FEE899ACE29821E551B1F309FE8E18A1D5AB8F9CFAA7ED140C35340EC5AD6E91BD696A1F3D9BC5A84B385BCC24EC9B8DF45EF20B5258E2D4098F4328F831891BE7E5E0BB10CDA1E0B142AF3FE5D093B6557FAB9AFE31729B117BAF05677B78F203024F732E95F6052DA53820B3C585F17E0F288982A77B70EBC3AFAC463A194EF0136A5F34FC3A8383D5B0B8CAA475ACFDA231D6902BD8C2DB3D565238194E735F7C16E549BFB749B6DBC1402751A5CD9D14665DF3EC797252C2925BE143CB112C5A640419071864AECD0693350C6D5B6BF4D3B45A836D907C1512826A9FE724909BBADA32F89F8D18A49C0390F66D726A3D54787B4A579CBC93F08F8E54ED9E2CFEE3C3E507EF3C520EBAA6638E64C254B3E1577732206EE7A7E30DBF4012148363D5B85F8DF996676421889FF32C2F19CC90877BD7C9C1F63E92A497D35CA44714BE4AF300EC4AD63A780E59B26684F99DFFF13E6795B75C3194E157124A4FD3E451067B7BAE220148700FB977857B2863DD38C3E1C3149EA7CAC98F160C6C8F1A5168FDC4526F8E15C06A2B9766D275BD9BCE92879176EA7D2C6AA09DEFA1E09719E93D1BD58F0EF381BC22CE41827FA9C8D7D4E9B59ABA57F8A5D43056F7B15080C1449AE41A7D89D80B65AA58A1412DA08F062CE39DC9E1602C06E647702E20F95818C5704FF5F40AEC82D6BD10EB228E89BA2523E0BAFB670E739F97837238D31DE57E3073F77A3FA75635A942612636980F0F8762A668B2DD8062CA2FBFFF2136C6EE73BCF12960FA827A04ACFE07489EB9F4B1463135ED0E92B3FE813B4FDDDFC19AF2118174EE9D902FC87F04FB9E6AE3FDEB5F43CDCBCAE4CFDCA1D9750AFB06A92871E5D881B78B57F99D932A809835A513C8561500F8DEBA335EF5FC2083EBC9C6624770AFE10AF44317EB7A8A81D049F32C163D7F95E9233B04F8B3BF7DA5CEBA4CED1E9B45A7B9984912D981DFA86C72AE8AAEF935D3A70DD6EB03636B1192CAEE8CD30631F4A8B191A4ACFF47D115FE904F741BA8B6AED08530066635749B70983FE501A9772D3628F90654A0E57754BCD060797E4427511CBB19ED9E3F51078EDD436B1A409D5E1B7720FC33CA613548E0D33D52F75B7998CEE27B369810D48B240C18B33425BD9C1E2F60AACD278B117D239A01B11969B0F0011F6DC170A512E8F9ECB368D6B2F369F85859FDADA106DFF716E6AC129048A4E5BAFC993CA650751D916BED6F473378E49E46941D39EAA41D819A38919ED747A7A57B9EDC818CA0EE0577F8BFA057D5E13082F06EDDBF58DE1D8551EF98787B61FA8ADC1ED0AF68AC0FD35D217E27D7E61126E90DD687221F4AE8F3FA6D36FFEAFBD3976C20528CD74F8FE54FE4609ADB714C60509F89FF891EC2E0033AE0323D8CA8E7D06889B26702328090E6D838FB9D2B019C8B5C188AE40F34AD2134E026C90EEE0B0CB8898B37FF90F50C64EBE505622DE08B7A90051E7627803B0F2F37AE1EBB32B4B4EB120CF89E746F8210E41BBBE9268112596D7E85B90E83C8ADA4CEA8C79A6333A4646CCD5520884899F081DE8298D46B283D0F6CACBFAEF7F0C9F8C4489D1C786798F4C7B095B64902BD54FAE3B3DE35A72BFB0D4EDA139F6D265AE9BFDAA28F11B393025D64C416AE987657E3F9F44F0BC55D4ADDDABDCC81E3AD9FC54BFCDE08E2250ADB5D2E5F3B17C68050066699638C86F55A72F074104C11AE062CF387B99C7DCFE6F915FBE5BD337D9501DEB8C9354D76E44DE944D0B8DD763A5EE83C26A8AD4B09DEAD349C297A644DFFE935BCDE658E4BD8FB41D633E34A56EACB7BD9E90D62449B13041A8E1DBF428DCF85CC704DBBCD26D265FA4F80B7F24D4041F5F5393E766FADAD2D7159FA1F75061319BB250235CBE2263E673B9A825FD935E67E6C369D98DA12AA8282193201D2AD34A8FA3B829F934D67C5CD6424B30A53DC50BE4F1A84122DA68D05F5D57DAABB7D7C213A36476E83336607A82DD6C605FC108117E8C2CF0092F6AC5648052769581B8AFDBD0E8A0DDB4B2E857ED74E841D112C1BD011A1402D1FDEF910A8E4F6D11B79776ABF4D357B428E83DC5F58A1BB6A6CF72F226C1D2F34FDFACF7326F35D646CB380DDA7F7F9393AE96C086BA87BCE6F88057946BD7AFAE472C2BF43E44BEFC7C88C952EBAD0B8B05B6BFB85735F147126F7BB4B2E828206B9AC75C8DE0D03BF671DB001D5AAA569729CAE7D9390B1D31BEF41307AF33E18C1EFA0E379D82BA8D9D6DE310EFA06CA444AC541BB7F9FB4939CA72076A19D4D7FB73AD5CE1E20D282C67AE81369D2EA2AAFA2F6E67A5C7C108EBA6D2B7B386F2969B573A4471F5677B16623F116964BC5813C8635FA31DD5C755AD822C6D6117D16E86F0C232CBD486AE619FBEDED6155157247BBB9909D72233E8C1371D20205F61EA198F5FE970719A1F634F683B6C19E75FEB5F0BDAD695705205BD731382007D281D8E332DA6C4702C488B1EE6592E55FA7720B6E33897279E3849E8F28F0428376E61E3677EAD3A71350653388F37CE89214852B624DE24AF7B9F09F42C34711EC1865DE7EBFB5F1E2E32E313D9B03A4DBA69517BDAC32DF67A28E8619F1D5898CE76E79AD978C6A69247FD1D70F3B56BDAA0B39FC93B6161194AEA5694D414F03449908B69AE3DCFD41D24E6499EB3F2D8C937E4C426D2E05F493D3EE8C4431A19F50265B566A791BA724877BEDCFC924B9D1DF3EFAFE1245810138C7B826EA11BF049C691B42BC9206D43623E452B62DA1C04195BE5AA966AD8E7142F11846BBFE5CE841429EE0A3D47C236CA43399E2BA1C620B1A722A2C16D55A4B4435881934CF6133CC293691C93325AB8524B42997A0E1A5FF93FE98'
def decrypt(text):
    # print('text:',text)
    # key = 'sycmsycmsycmsycm'.encode('utf-8')
    # iv = b'mcysmcysmcysmcys'
    key = 'w28Cz694s63kBYk4'.encode('utf-8')# 密码
    iv = b'4kYBk36s496zC82w'# 偏移量
    mode = AES.MODE_CBC
    cryptos = AES.new(key, mode, iv)
    plain_text = cryptos.decrypt(a2b_hex(text))
    # print(bytes.decode(plain_text))
    res = bytes.decode(plain_text).rstrip('\0').replace('：', ':').replace('null', '0').replace("true",'\"true\"').replace("false", '\"false\"')
    # print(res)
    # .replace('\t','').replace(' ', '')
    # 取出最后一位字符
    try:
        last = res[-1]
        if last != ']' and last != '}':  # 如说last不等于 ] 和 } ,说明有填充，则替换掉
            res = res.replace(last, '')
    except IndexError:  # 报错则说明是空串， 返回false
        return False

    try:
        first = res[0]          # 判断字符串是字典还是列表
    except IndexError:         # 报此错说明是个空串
        return res

    first = res[0]
    if first == '[':
        # print(type(res))
        data = eval(res.replace('babe"true"','babetrue'))
        return data
    elif first == '{':
        data = json.loads(res.replace('babe"true"','babetrue'), strict=False)
        # data = res
        return data
    return res


# 店透视
def change_info(cateid, value, dts_cookie):
    # values = []
    # for i in value:
    #     values.append(str(int(i)))
    url = 'https://diantoushi.com/switch/v2/change'
    headers = {
        'accept': 'application/json, text/javascript, */*; q=0.01',
        'accept-encoding': 'gzip, deflate, br',
        'accept-language': 'zh-CN,zh;q=0.9',
        'cache-control': 'no-cache',
        'content-length': '63',
        'content-type': 'application/json',
        'cookie': dts_cookie,
        'origin': 'https://www.diantoushi.com',
        'pragma': 'no-cache',
        'referer': 'https://www.diantoushi.com/index.html',
        'sec-ch-ua': '"Chromium";v="94", "Google Chrome";v="94", ";Not A Brand";v="99"',
        'sec-ch-ua-mobile': '?0',
        'sec-ch-ua-platform': "Windows",
        'sec-fetch-dest': 'empty',
        'sec-fetch-mode': 'cors',
        'sec-fetch-site': 'same-origin',
        'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.54 Safari/537.36',
        'x-requested-with': 'XMLHttpRequest'
    }
    data = {"categoryId": "50014812", "changeType": "1", "indexTrans": '[{"' + value[0] + '":"' + str(value[1]) + '","num":1}]'}
    # data = {"categoryId": cateid, "changeType": "1", "indexTrans": '[{"' + value[0] + '":"' + str(value[1]) + '","num":1}]'}
    response = requests.post(url=url, headers=headers, json=data).json()
    return response['data'][0][value[0]+'Change']


# if __name__ == '__main__':
    # change_info("50252001", ['sePvIndex', 208877], 'Hm_lvt_623a6e6c9e21142aa93edc3fffb24a30=1663579827; token=80265f3e-7127-4e7a-af6b-5d3f450d00b5; Hm_lpvt_623a6e6c9e21142aa93edc3fffb24a30=1663583486')
